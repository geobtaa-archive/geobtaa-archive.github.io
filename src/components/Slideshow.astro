---
// src/components/Slideshow.astro
---

<div class="slideshow-container">
  
  <div class="slides-nav">
    <button id="prev-btn">&larr; Previous</button>
    <span id="slide-counter"></span>
    <button id="next-btn">Next &rarr;</button>
  </div>
  
  <div id="slides-content" class="prose">
    <slot />
  </div>

</div>

<style>
  .slideshow-container {
    border: 1px solid var(--sl-btaa-white);
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin-top: 1rem;
    background-color: var(--sl-btaa-white);
    /* height: 500px; */
  }

  #slides-content > :global(div.slide) {
    display: none;
  }
  #slides-content > :global(div.slide.active) {
    display: block;
  }

  /* CSS for the nav bar has been updated for its new top position */
  .slides-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem; /* Changed from margin-top */
    padding-bottom: 1rem;   /* Changed from padding-top */
    border-bottom: 1px solid var(--sl-color-gray-5); /* Changed from border-top */
  }

  .slides-nav button {
    background-color: var(--sl-color-accent-low);
    color: var(--sl-color-white);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
    cursor: pointer;
    font-weight: bold;
  }

  .slides-nav button:hover {
    background-color: var(--sl-color-accent);
  }

  .slides-nav button:disabled {
    background-color: var(--sl-color-gray-4);
    cursor: not-allowed;
  }
</style>

<script is:inline>
  function setupSlideshow() {
    const container = document.getElementById('slides-content');
    if (!container || container.dataset.processed) {
      return;
    }
    container.dataset.processed = 'true';

    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const counter = document.getElementById('slide-counter');

    const rawHtml = container.innerHTML;
    const htmlChunks = rawHtml.split(/<hr\s*\/?>/i);

    const slides = htmlChunks
      .map(chunk => chunk.trim())
      .filter(chunk => chunk.length > 0)
      .map(chunk => {
        const slide = document.createElement('div');
        slide.className = 'slide';
        slide.innerHTML = chunk;
        return slide;
      });
    
    container.innerHTML = '';
    slides.forEach(slide => container.appendChild(slide));
    
    if (slides.length <= 1) {
        const nav = document.querySelector('.slides-nav');
        if (nav) nav.style.display = 'none';
        if (slides.length > 0) slides[0].classList.add('active');
        return;
    }
    
    let currentSlideIndex = 0;
    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === index);
      });
      if(counter) counter.textContent = `Slide ${index + 1} of ${slides.length}`;
      if(prevBtn) prevBtn.disabled = index === 0;
      if(nextBtn) nextBtn.disabled = index === slides.length - 1;
    }

    prevBtn?.addEventListener('click', () => {
      if (currentSlideIndex > 0) {
        currentSlideIndex--;
        showSlide(currentSlideIndex);
      }
    });

    nextBtn?.addEventListener('click', () => {
      if (currentSlideIndex < slides.length - 1) {
        currentSlideIndex++;
        showSlide(currentSlideIndex);
      }
    });

    showSlide(0);
  }

  setupSlideshow();
  document.addEventListener('astro:page-load', setupSlideshow);
</script>